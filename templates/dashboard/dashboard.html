{% extends 'base.html' %}
{% load static %}
{% block title %}Dashboard - O'quv Markazi{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Bugungi ko'rsatkichlar va statistika{% endblock %}

{% block content %}
<!-- Statistics Cards -->
<div class="stats-grid">
    {% if user.role == 'admin' %}
    <!-- Total Students -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon primary">
                <i class="fas fa-user-graduate"></i>
            </div>
            <div class="stat-trend up">
                <i class="fas fa-arrow-up"></i> 12%
            </div>
        </div>
        <div class="stat-value">{{ total_students }}</div>
        <div class="stat-label">Jami o'quvchilar</div>
    </div>

    <!-- Total Teachers -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon success">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <div class="stat-trend up">
                <i class="fas fa-arrow-up"></i> 5%
            </div>
        </div>
        <div class="stat-value">{{ total_teachers }}</div>
        <div class="stat-label">Jami o'qituvchilar</div>
    </div>

    <!-- Active Groups -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon warning">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-trend up">
                <i class="fas fa-arrow-up"></i> 8%
            </div>
        </div>
        <div class="stat-value">{{ total_groups }}</div>
        <div class="stat-label">Faol guruhlar</div>
    </div>

    <!-- Pending Tasks -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon danger">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <div class="stat-trend down">
                <i class="fas fa-arrow-down"></i> 3%
            </div>
        </div>
        <div class="stat-value">{{ pending_tasks }}</div>
        <div class="stat-label">Kutilayotgan vazifalar</div>
    </div>
    {% endif %}

    {% if user.role == 'teacher' %}
    <!-- My Groups -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon primary">
                <i class="fas fa-users"></i>
            </div>
        </div>
        <div class="stat-value">{{ my_groups_count }}</div>
        <div class="stat-label">Mening guruhlarim</div>
    </div>

    <!-- My Students -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon success">
                <i class="fas fa-user-graduate"></i>
            </div>
        </div>
        <div class="stat-value">{{ my_students_count }}</div>
        <div class="stat-label">Mening o'quvchilarim</div>
    </div>

    <!-- Active Homework -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon warning">
                <i class="fas fa-tasks"></i>
            </div>
        </div>
        <div class="stat-value">{{ active_homework }}</div>
        <div class="stat-label">Faol vazifalar</div>
    </div>

    <!-- Submissions -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon info">
                <i class="fas fa-check-double"></i>
            </div>
        </div>
        <div class="stat-value">{{ new_submissions }}</div>
        <div class="stat-label">Yangi topshiriqlar</div>
    </div>
    {% endif %}

    {% if user.role == 'student' %}
    <!-- My Groups -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon primary">
                <i class="fas fa-users"></i>
            </div>
        </div>
        <div class="stat-value">{{ enrolled_groups }}</div>
        <div class="stat-label">Guruhlarim</div>
    </div>

    <!-- Active Homework -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon warning">
                <i class="fas fa-tasks"></i>
            </div>
        </div>
        <div class="stat-value">{{ pending_homework }}</div>
        <div class="stat-label">Bajarilmagan vazifalar</div>
    </div>

    <!-- Completed -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
        </div>
        <div class="stat-value">{{ completed_homework }}</div>
        <div class="stat-label">Bajarilgan vazifalar</div>
    </div>

    <!-- Average Grade -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon info">
                <i class="fas fa-star"></i>
            </div>
        </div>
        <div class="stat-value">{{ average_grade }}%</div>
        <div class="stat-label">O'rtacha baho</div>
    </div>
    {% endif %}
</div>

<!-- Content Grid -->
<div class="content-grid">
    <!-- Recent Activities -->
    <div class="content-card" style="grid-column: 1 / -1;">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-history"></i> Oxirgi faoliyatlar
            </h3>
            <a href="#" class="card-action">Barchasini ko'rish <i class="fas fa-arrow-right"></i></a>
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Faoliyat</th>
                        <th>Foydalanuvchi</th>
                        <th>Sana</th>
                        <th>Holat</th>
                    </tr>
                </thead>
                <tbody>
                    {% for activity in recent_activities %}
                    <tr>
                        <td>
                            <div class="d-flex align-center gap-2">
                                <i class="fas fa-{{ activity.icon }}"></i>
                                <span>{{ activity.title }}</span>
                            </div>
                        </td>
                        <td>{{ activity.user }}</td>
                        <td>{{ activity.created_at|date:"d M Y, H:i" }}</td>
                        <td>
                            <span class="status-badge {{ activity.status }}">
                                {{ activity.get_status_display }}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center">Hech qanday faoliyat topilmadi</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Upcoming Homework (For Students) -->
    {% if user.role == 'student' %}
    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-clock"></i> Yaqinlashib kelayotgan vazifalar
            </h3>
            <a href="#" class="card-action">Barchasini ko'rish</a>
        </div>
        <div class="homework-list">
            {% for homework in upcoming_homework %}
            <div class="homework-item">
                <div class="homework-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="homework-info">
                    <h4>{{ homework.title }}</h4>
                    <p>{{ homework.group.name }} - {{ homework.deadline|date:"d M Y" }}</p>
                </div>
                <a href="{% url 'homework_detail' homework.id %}" class="btn btn-primary btn-sm">
                    Ko'rish
                </a>
            </div>
            {% empty %}
            <p class="text-center text-secondary">Vazifalar yo'q</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- My Groups (For Teachers) -->
    {% if user.role in 'teacher,admin' %}
    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-users"></i> Mening guruhlarim
            </h3>
            <a href="#" class="card-action">Barchasini ko'rish</a>
        </div>
        <div class="groups-list">
            {% for group in my_groups %}
            <div class="group-item">
                <div class="group-icon" style="background: linear-gradient(135deg, {{ group.color_from }}, {{ group.color_to }});">
                    {{ group.name|slice:":1" }}
                </div>
                <div class="group-info">
                    <h4>{{ group.name }}</h4>
                    <p>{{ group.members_count }} o'quvchi - {{ group.category.name }}</p>
                </div>
                <a href="{% url 'group_detail' group.id %}" class="btn btn-secondary btn-sm">
                    Ko'rish
                </a>
            </div>
            {% empty %}
            <p class="text-center text-secondary">Guruhlar yo'q</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Recent Messages -->
    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-envelope"></i> Oxirgi xabarlar
            </h3>
            <a href="#" class="card-action">Barchasini ko'rish</a>
        </div>
        <div class="messages-list">
            {% for message in recent_messages %}
            <div class="message-item">
                <img src="{{ message.sender.profile_picture.url }}" alt="{{ message.sender.get_full_name }}" class="message-avatar">
                <div class="message-content">
                    <h4>{{ message.sender.get_full_name }}</h4>
                    <p>{{ message.content|truncatewords:10 }}</p>
                    <small>{{ message.created_at|timesince }} oldin</small>
                </div>
            </div>
            {% empty %}
            <p class="text-center text-secondary">Xabarlar yo'q</p>
            {% endfor %}
        </div>
    </div>
</div>

<style>
/* Homework List Styles */
.homework-list, .groups-list, .messages-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.homework-item, .group-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--dark-bg);
    border: 1px solid var(--dark-border);
    border-radius: 12px;
    transition: var(--transition-fast);
}

.homework-item:hover, .group-item:hover {
    background: rgba(99, 102, 241, 0.05);
    border-color: var(--primary-color);
    transform: translateX(5px);
}

.homework-icon, .group-icon {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    font-weight: 700;
}

.homework-info, .group-info {
    flex: 1;
}

.homework-info h4, .group-info h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.homework-info p, .group-info p {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.813rem;
}

/* Message Item Styles */
.message-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background: var(--dark-bg);
    border: 1px solid var(--dark-border);
    border-radius: 12px;
    transition: var(--transition-fast);
}

.message-item:hover {
    background: rgba(99, 102, 241, 0.05);
    border-color: var(--primary-color);
}

.message-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
}

.message-content {
    flex: 1;
}

.message-content h4 {
    font-size: 0.938rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.message-content p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
}

.message-content small {
    font-size: 0.75rem;
    color: var(--text-secondary);
}
</style>
{% endblock %}
